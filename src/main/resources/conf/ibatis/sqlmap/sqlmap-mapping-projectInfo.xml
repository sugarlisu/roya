<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<!-- 项目管理表 -->
<sqlMap namespace="projectInfo">
	<resultMap class="com.roya.dto.ProjectInfoDTO" id="projectInfResult">
		<result property="id" column="ID"/>
		<result property="projectName" column="PROJECT_NAME"/>
		<result property="projectVersionNum" column="PROJECT_VERSION_NUM"/>
		<result property="projectStatus" column="PROJECT_STATUS"/>
		<result property="demandSide" column="DEMAND_SIDE"/>
		<result property="productSide" column="PRODUCT_SIDE"/>
		<result property="projectDeveloper" column="PROJECT_DEVELOPER"/>
		<result property="projectTester" column="PROJECT_TESTER"/>
		<result property="projectDesc" column="PROJECT_DESC"/>
		<result property="brdDate" column="BRD_DATE"/>
		<result property="prdDate" column="PRD_DATE"/>
		<result property="projectExpectBeginDate" column="PROJECT_EXPECT_BEGIN_DATE"/>
		<result property="projectExpectTestDate" column="PROJECT_EXPECT_TEST_DATE"/>
		<result property="projectExpectSuccessDate" column="PROJECT_EXPECT_SUCCESS_DATE"/>
		<result property="projectRealBeginDate" column="PROJECT_REAL_BEGIN_DATE"/>
		<result property="projectRealTestDate" column="PROJECT_REAL_TEST_DATE"/>
		<result property="projectRealSuccessDate" column="PROJECT_REAL_SUCCESS_DATE"/>
		<result property="createDate" column="CREATE_DATE"/>
		<result property="createBy" column="CREATE_BY"/>
		<result property="updateDate" column="UPDATE_DATE"/>
		<result property="updateBy" column="UPDATE_BY"/>
	</resultMap> 
	<insert id="addProjectInfo" parameterClass="com.roya.dto.ProjectInfoDTO">
		<![CDATA[
		INSERT INTO 
			im_project_info 
		(
			PROJECT_NAME,
			PROJECT_VERSION_NUM,
			PROJECT_STATUS,
			DEMAND_SIDE,
			PRODUCT_SIDE,
			PROJECT_DEVELOPER,
			PROJECT_TESTER,
			PROJECT_DESC,
			BRD_DATE,
			PRD_DATE,
			PROJECT_EXPECT_BEGIN_DATE,
			PROJECT_EXPECT_TEST_DATE,
			PROJECT_EXPECT_SUCCESS_DATE,
			PROJECT_REAL_BEGIN_DATE,
			PROJECT_REAL_TEST_DATE,
			PROJECT_REAL_SUCCESS_DATE,
			CREATE_DATE,
			CREATE_BY,
			UPDATE_DATE,
			UPDATE_BY
		)
		VALUES
		(
				#projectName#,
				#projectVersionNum#,
				#projectStatus#,
				#demandSide#,
				#productSide#,
				#projectDeveloper#,
				#projectTester#,
				#projectDesc#,
				#brdDate#,
				#prdDate#,
				#projectExpectBeginDate#,
				#projectExpectTestDate#,
				#projectExpectSuccessDate#,
				#projectRealBeginDate#,
				#projectRealTestDate#,
				#projectRealSuccessDate#,
				#createDate#,
				#createBy#,
				#updateDate#,
				#updateBy#
		)
		]]>
		<selectKey resultClass="int" keyProperty="id">
			SELECT @@IDENTITY AS id
		</selectKey>
	</insert>
	<select id="queryProjectInfoList" resultMap="projectInfResult" parameterClass="com.roya.dto.ProjectInfoDTO">
		<![CDATA[
			SELECT
				*
			FROM
				im_project_info ipi
			WHERE 
				ipi.DELETE_TAG='1'
		]]>
			<isNotEmpty prepend="and" property="projectStatus">
				ipi.PROJECT_STATUS = #projectStatus#
			</isNotEmpty>
			order by ipi.PROJECT_STATUS desc		
	</select>
	<select id="queryProjectInfo" resultMap="projectInfResult" parameterClass="com.roya.dto.ProjectInfoDTO">
		<![CDATA[
			SELECT
				*
			FROM
				im_project_info ipi
			WHERE 
				ipi.DELETE_TAG='1'
		]]>
				and 	ipi.id = #id#
	</select>
	<delete id="deleteProjectInfo" parameterClass="com.roya.dto.ProjectInfoDTO">
		<![CDATA[
			update  im_project_info ipi set   ipi.DELETE_TAG='2'  where ipi.id = #id#  and ipi.DELETE_TAG='1'
		]]>
	</delete>
	<update id="updateProjectInfo" parameterClass="java.util.Map">
		update
			im_project_info ipi 
		set 
	     <isPropertyAvailable property="projectName" >
          	      <isNotEmpty  prepend="" property="projectName"> ipi.PROJECT_NAME = #projectName#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectName"> ipi.PROJECT_NAME = null,</isEmpty >
        </isPropertyAvailable>
	     <isPropertyAvailable property="projectVersionNum" >
          	      <isNotEmpty  prepend="" property="projectVersionNum"> ipi.PROJECT_VERSION_NUM = #projectVersionNum#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectVersionNum"> ipi.PROJECT_VERSION_NUM = null,</isEmpty >
        </isPropertyAvailable>
	     <isPropertyAvailable property="projectStatus" >
          	      <isNotEmpty  prepend="" property="projectStatus"> ipi.PROJECT_STATUS = #projectStatus#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectStatus"> ipi.PROJECT_STATUS = null,</isEmpty >
        </isPropertyAvailable>
		<isPropertyAvailable property="demandSide" >
          	      <isNotEmpty  prepend="" property="demandSide"> ipi.DEMAND_SIDE = #demandSide#,</isNotEmpty>
          	      <isEmpty   prepend="" property="demandSide"> ipi.DEMAND_SIDE = null,</isEmpty >
        </isPropertyAvailable>
   		<isPropertyAvailable property="productSide" >
          	      <isNotEmpty  prepend="" property="productSide"> ipi.PRODUCT_SIDE = #productSide#,</isNotEmpty>
          	      <isEmpty   prepend="" property="productSide"> ipi.PRODUCT_SIDE = null,</isEmpty >
        </isPropertyAvailable>
   		<isPropertyAvailable property="projectDeveloper" >
          	      <isNotEmpty  prepend="" property="projectDeveloper"> ipi.PROJECT_DEVELOPER = #projectDeveloper#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectDeveloper"> ipi.PROJECT_DEVELOPER = null,</isEmpty >
        </isPropertyAvailable>
   		<isPropertyAvailable property="projectTester" >
          	      <isNotEmpty  prepend="" property="projectTester"> ipi.PROJECT_TESTER = #projectTester#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectTester"> ipi.PROJECT_TESTER = null,</isEmpty >
        </isPropertyAvailable>
   		<isPropertyAvailable property="projectDesc" >
          	      <isNotEmpty  prepend="" property="projectDesc"> ipi.PROJECT_DESC = #projectDesc#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectDesc"> ipi.PROJECT_DESC = null,</isEmpty >
        </isPropertyAvailable>
   		<isPropertyAvailable property="brdDate" >
          	      <isNotEmpty  prepend="" property="brdDate"> ipi.BRD_DATE = #brdDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="brdDate"> ipi.BRD_DATE = null,</isEmpty >
        </isPropertyAvailable>
   		<isPropertyAvailable property="prdDate" >
          	      <isNotEmpty  prepend="" property="prdDate"> ipi.PRD_DATE = #prdDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="prdDate"> ipi.PRD_DATE = null,</isEmpty >
        </isPropertyAvailable>
     	<isPropertyAvailable property="projectExpectBeginDate" >
          	      <isNotEmpty  prepend="" property="projectExpectBeginDate"> ipi.PROJECT_EXPECT_BEGIN_DATE = #projectExpectBeginDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectExpectBeginDate"> ipi.PROJECT_EXPECT_BEGIN_DATE = null,</isEmpty >
        </isPropertyAvailable>
     	<isPropertyAvailable property="projectExpectTestDate" >
          	      <isNotEmpty  prepend="" property="projectExpectTestDate"> ipi.PROJECT_EXPECT_TEST_DATE = #projectExpectTestDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectExpectTestDate"> ipi.PROJECT_EXPECT_TEST_DATE = null,</isEmpty >
        </isPropertyAvailable>
     	<isPropertyAvailable property="projectExpectSuccessDate" >
          	      <isNotEmpty  prepend="" property="projectExpectSuccessDate"> ipi.PROJECT_EXPECT_SUCCESS_DATE = #projectExpectSuccessDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectExpectSuccessDate"> ipi.PROJECT_EXPECT_SUCCESS_DATE = null,</isEmpty >
        </isPropertyAvailable>
     	<isPropertyAvailable property="projectRealBeginDate" >
          	      <isNotEmpty  prepend="" property="projectRealBeginDate"> ipi.PROJECT_REAL_BEGIN_DATE = #projectRealBeginDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectRealBeginDate"> ipi.PROJECT_REAL_BEGIN_DATE = null,</isEmpty >
        </isPropertyAvailable>
     	<isPropertyAvailable property="projectRealTestDate" >
          	      <isNotEmpty  prepend="" property="projectRealTestDate"> ipi.PROJECT_REAL_TEST_DATE = #projectRealTestDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectRealTestDate"> ipi.PROJECT_REAL_TEST_DATE = null,</isEmpty >
        </isPropertyAvailable>
     	<isPropertyAvailable property="projectRealSuccessDate" >
          	      <isNotEmpty  prepend="" property="projectRealSuccessDate"> ipi.PROJECT_REAL_SUCCESS_DATE = #projectRealSuccessDate#,</isNotEmpty>
          	      <isEmpty   prepend="" property="projectRealSuccessDate"> ipi.PROJECT_REAL_SUCCESS_DATE = null,</isEmpty >
        </isPropertyAvailable>
		ipi.UPDATE_BY = #updateBy#,
		ipi.UPDATE_DATE=#updateDate#
		where ipi.id = #id# and ipi.delete_tag = '1'
	</update>
	
	<select id="queryProjectInfoHome" resultMap="projectInfResult" >
			
		(
		SELECT
			*
		FROM
			im_project_info ipi 
		where 
			ipi.DELETE_TAG = '1'
		and 
			ipi.PROJECT_STATUS = '00'
		
		order by ipi.PROJECT_REAL_SUCCESS_DATE desc
		 
		 LIMIT 0,3
		)
		UNION ALL
		(
		SELECT
			*
		FROM
			im_project_info ipi 
		where 
			ipi.DELETE_TAG = '1'
		and 
			ipi.PROJECT_STATUS != '00'
		order by ipi.PROJECT_STATUS desc
		 LIMIT 0,5
		)
	</select>
</sqlMap>